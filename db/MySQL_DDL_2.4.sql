CREATE SCHEMA IF NOT EXISTS `nbankdb`;
USE `nbankdb`;

CREATE TABLE IF NOT EXISTS `customer`(
	id INT PRIMARY KEY AUTO_INCREMENT,
	full_name VARCHAR(50) NOT NULL,
	nic VARCHAR(15) NOT NULL UNIQUE,
	email VARCHAR(100) NOT NULL,
	phone VARCHAR(20) NOT NULL,
	address TEXT NOT NULL,
	created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS `account`(
	id INT PRIMARY KEY AUTO_INCREMENT,
	customer_id INT NOT NULL,
	type ENUM('SAVINGS', 'CURRENT') NOT NULL,
	acc_no VARCHAR(20) NOT NULL,
	interest_eligible TINYINT DEFAULT 1 NOT NULL,
	created_at DATETIME DEFAULT CURRENT_TIMESTAMP,

	FOREIGN KEY (customer_id) REFERENCES customer(id)
);

CREATE TABLE IF NOT EXISTS `transaction` (
	id INT PRIMARY KEY AUTO_INCREMENT,
	account_id INT NOT NULL,
	type ENUM('DEPOSIT', 'WITHDRAWAL', 'TRANSFER_IN', 'TRANSFER_OUT', 'INTEREST') NOT NULL,
	status ENUM('PENDING', 'COMPLETED', 'FAILED') NOT NULL,
	amount DECIMAL(15, 2) NOT NULL,
	description VARCHAR(255),
	createdat DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL,

	FOREIGN KEY (account_id) REFERENCES account(id)
);

CREATE TABLE IF NOT EXISTS `scheduled_transaction`(
	transaction_id INT PRIMARY KEY,
	scheduledat DATETIME DEFAULT CURRENT_TIMESTAMP,
	createdat DATETIME DEFAULT CURRENT_TIMESTAMP,

	FOREIGN KEY (transaction_id) REFERENCES `transaction`(id)
);


CREATE TABLE IF NOT EXISTS `login_credentials`(
	id INT PRIMARY KEY AUTO_INCREMENT,
	username VARCHAR(50) NOT NULL,
	password VARCHAR(100) NOT NULL,
	role ENUM('ADMIN', 'CUSTOMER') NOT NULL,
	customer_id INT,

	FOREIGN KEY (customer_id) REFERENCES customer(id)
);

CREATE TABLE IF NOT EXISTS `interest` (
	id INT PRIMARY KEY AUTO_INCREMENT,
	account_id INT NOT NULL,
	amount DECIMAL(15, 2) NOT NULL,
	calculated_for DATE NOT NULL,
	applied_at DATETIME DEFAULT CURRENT_TIMESTAMP,

	FOREIGN KEY (account_id) REFERENCES account(id)
);

CREATE TABLE IF NOT EXISTS `balance`(
	account_id INT PRIMARY KEY NOT NULL,
	balance DECIMAL(20,2) NOT NULL,

	FOREIGN KEY (account_id) REFERENCES account(id)

);